class SearchManager{constructor(){this.searchData=null,this.searchIndex=null,this.isSearchPage=window.location.pathname.includes("/search")||document.body.classList.contains("search-page"),this.currentQuery="",this.currentPage=1,this.resultsPerPage=10,this.allResults=[],this.init()}async init(){try{await this.loadSearchData(),this.setupEventListeners(),this.isSearchPage&&this.initializeSearchPage()}catch(e){console.error("Search initialization failed:",e)}}async loadSearchData(){try{const e=await fetch("/index.json");if(!e.ok)throw new Error("Failed to load search data");this.searchData=await e.json(),this.buildSearchIndex()}catch(e){throw console.error("Error loading search data:",e),e}}buildSearchIndex(){this.searchIndex=this.searchData.map(e=>({...e,sections:e.sections||[],content:e.content||""}))}setupEventListeners(){const e=document.getElementById("search-input");if(!e)return;let t;e.addEventListener("input",e=>{clearTimeout(t);const n=e.target.value.trim();if(n.length<2){this.clearResults();return}t=setTimeout(()=>{this.performSearch(n)},300)}),e.addEventListener("keydown",t=>{t.key==="Escape"&&(e.value="",this.clearResults(),e.blur())})}initializeSearchPage(){const t=document.getElementById("search-input"),n=new URLSearchParams(window.location.search),e=n.get("q");e&&t&&(t.value=e,this.performSearch(e))}performSearch(e){this.currentQuery=e.toLowerCase(),this.currentPage=1,this.showLoading(),this.allResults=this.getAllSearchResults(this.currentQuery),this.hideLoading(),this.displayResults(),this.isSearchPage&&this.updateURL(e)}getAllSearchResults(e){const t=[];return this.searchIndex.forEach(n=>{const s=this.calculateScore(n,e,n.title+" "+n.content);s>0&&t.push({...n,type:"page",score:s,title:n.title,url:n.permalink,date:n.date,tags:n.tags,summary:this.extractContext(n.content,e),anchor:null}),n.sections&&n.sections.length>0&&n.sections.forEach(s=>{const o=this.calculateScore(s,e,s.title+" "+s.content);o>0&&t.push({...n,type:"section",score:o,title:s.title||n.title,url:n.permalink,date:n.date,tags:n.tags,summary:this.extractContext(s.content,e),anchor:s.anchor,sectionTitle:s.title,pageTitle:n.title})})}),t.sort((e,t)=>t.score-e.score)}calculateScore(e,t,n){const i=n.toLowerCase(),o=t.toLowerCase();let s=0;i.includes(o)&&(s+=100),e.title&&e.title.toLowerCase().includes(o)&&(s+=50);const a=o.split(" ").filter(e=>e.length>0);return a.forEach(e=>{const t=(i.match(new RegExp(e,"g"))||[]).length;s+=t*10}),s}extractContext(e,t,n=200){if(!e)return"";const r=e.toLowerCase(),c=t.toLowerCase(),o=r.indexOf(c);if(o===-1)return e.substring(0,n)+(e.length>n?"...":"");const i=Math.max(0,o-100),a=Math.min(e.length,o+t.length+100);let s=e.substring(i,a);return i>0&&(s="..."+s),a<e.length&&(s=s+"..."),s}displayResults(){const e=document.getElementById("search-results-container");if(!e)return;if(this.allResults.length===0){e.innerHTML=`
                <div class="search-no-results">
                    <p>No results found for "${this.currentQuery}"</p>
                </div>
            `;return}const t=(this.currentPage-1)*this.resultsPerPage,n=t+this.resultsPerPage,s=this.allResults.slice(t,n),o=s.map(e=>this.generateResultHTML(e)).join("");e.innerHTML=o,this.allResults.length>this.resultsPerPage&&(e.innerHTML+=this.generatePagination()),this.updateStatus()}generateResultHTML(e){const t=e.date?this.formatDate(e.date):"",n=e.tags?this.generateTagsHTML(e.tags):"",s=e.type==="section"?`<div class="section-breadcrumb">From: ${this.escapeHtml(e.pageTitle)}</div>`:"";return`
            <div class="card-item" data-type="${e.type}">
                <div class="card-content">
                    <div class="card-header">
                        <a href="${e.url}${e.anchor?"#"+e.anchor:""}" class="card-title">
                            ${this.escapeHtml(e.title)}
                            ${e.anchor?'<span class="anchor-indicator">üìç</span>':""}
                        </a>
                    </div>
                    
                    ${s}
                    
                    <div class="card-preview">
                        <p class="card-summary">${this.highlightText(this.escapeHtml(e.summary),this.currentQuery)}</p>
                    </div>
                    
                    <div class="article-meta">
                        ${t?`<time datetime="${e.date}">${t}</time>`:""}
                        ${n}
                    </div>
                </div>
            </div>
        `}formatDate(e){try{const t=new Date(e);return t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return e}}generateTagsHTML(e){return!e||!Array.isArray(e)?"":`
            <span class="tags">
                ${e.map(e=>`<a href="/tags/${this.slugify(e)}/">#${this.escapeHtml(e)}</a>`).join("")}
            </span>
        `}generatePagination(){const t=Math.ceil(this.allResults.length/this.resultsPerPage);let e='<div class="pagination"><ul>';this.currentPage>1?e+=`<li><a href="#" data-page="${this.currentPage-1}">‚Äπ</a></li>`:e+='<li class="disabled"><span>‚Äπ</span></li>';const n=Math.max(1,this.currentPage-2),s=Math.min(t,this.currentPage+2);for(let t=n;t<=s;t++)t===this.currentPage?e+=`<li class="active"><span>${t}</span></li>`:e+=`<li><a href="#" data-page="${t}">${t}</a></li>`;return this.currentPage<t?e+=`<li><a href="#" data-page="${this.currentPage+1}">‚Ä∫</a></li>`:e+='<li class="disabled"><span>‚Ä∫</span></li>',e+="</ul></div>",e}highlightText(e,t){if(!t||!e)return e;const n=new RegExp(`(${this.escapeRegex(t)})`,"gi");return e.replace(n,"<mark>$1</mark>")}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}slugify(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}updateStatus(){const e=document.getElementById("search-status");if(!e)return;const t=this.allResults.length,n=(this.currentPage-1)*this.resultsPerPage+1,s=Math.min(n+this.resultsPerPage-1,t);e.textContent=`Showing ${n}-${s} of ${t} results`}showLoading(){const e=document.getElementById("search-results-container"),t=document.getElementById("search-input");e&&e.setAttribute("data-loading","true"),t&&t.setAttribute("data-loading","true")}hideLoading(){const e=document.getElementById("search-results-container"),t=document.getElementById("search-input");e&&e.removeAttribute("data-loading"),t&&t.removeAttribute("data-loading")}clearResults(){const e=document.getElementById("search-results-container"),t=document.getElementById("search-status");e&&(e.innerHTML=`
                <div class="search-initial-state">
                    <p>Enter a search term to find results.</p>
                </div>
            `),t&&(t.textContent=""),this.allResults=[],this.currentPage=1}updateURL(e){const t=new URL(window.location);e?t.searchParams.set("q",e):t.searchParams.delete("q"),window.history.replaceState({},"",t)}handlePaginationClick(e){e.preventDefault();const n=e.target.closest("[data-page]");if(!n)return;const t=parseInt(n.getAttribute("data-page"));if(t&&t!==this.currentPage){this.currentPage=t,this.displayResults();const e=document.getElementById("search-results-container");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}}}document.addEventListener("DOMContentLoaded",()=>{new SearchManager,document.addEventListener("click",e=>{e.target.closest(".pagination a[data-page]")&&(e.preventDefault(),window.searchManager&&window.searchManager.handlePaginationClick(e))})}),window.searchManager=new SearchManager