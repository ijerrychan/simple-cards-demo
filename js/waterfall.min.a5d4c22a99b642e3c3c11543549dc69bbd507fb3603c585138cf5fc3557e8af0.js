class WaterfallLayout{constructor(e,t={}){this.container=e,this.options={maxColumns:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--card-columns"))||3,minColumnWidth:280,gap:24,mobileBreakpoint:768,tabletBreakpoint:992,batchSize:50,enableVirtualScroll:!0,threshold:200,debounceDelay:100,mobileColumns:1,tabletColumns:2,enableMobileOptimization:!0,...t},this.items=[],this.columns=[],this.isInitialized=!1,this.resizeTimeout=null,this.visibleItems=new Set,this.observer=null,this.renderedCount=0,this.totalItems=0,this.isMobile=!1,this.isTablet=!1,this.init()}init(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup()}setup(){if(this.collectItems(),this.items.length===0)return;this.totalItems=this.items.length,this.updateDeviceType(),this.options.enableVirtualScroll&&this.totalItems>this.options.batchSize?(this.setupVirtualScroll(),this.batchRender()):(this.setupContainer(),this.calculateColumns(),this.distributeItems()),this.setupResizeListener(),this.setupTouchSupport(),this.isInitialized=!0,this.showContainer()}updateDeviceType(){const e=window.innerWidth;this.isMobile=e<=this.options.mobileBreakpoint,this.isTablet=e>this.options.mobileBreakpoint&&e<=this.options.tabletBreakpoint}collectItems(){const e=this.container.querySelectorAll(".card-item");this.items=Array.from(e).map(e=>({element:e,height:0,date:this.extractDate(e)}))}extractDate(e){const t=e.querySelector("time");return t?new Date(t.getAttribute("datetime")):new Date(0)}setupContainer(){this.container.style.cssText="position:relative;width:100%",this.isMobile&&this.options.enableMobileOptimization&&this.container.classList.add("mobile-waterfall")}calculateColumns(){const e=this.container.offsetWidth;this.updateDeviceType(),this.isMobile?this.options.columns=this.options.mobileColumns:this.isTablet?this.options.columns=this.options.tabletColumns:this.options.columns=Math.max(1,Math.min(Math.floor((e+this.options.gap)/(this.options.minColumnWidth+this.options.gap)),this.options.maxColumns)),this.columns=Array.from({length:this.options.columns},(e,t)=>({index:t,height:0,items:[]}))}distributeItems(){this.items.sort((e,t)=>t.date-e.date);const e=this.container.offsetWidth;if(this.isMobile&&this.options.enableMobileOptimization)this.distributeMobileItems("100%");else{const t=this.isTablet?e-2*16:e,n=this.options.columns===1?`${t}px`:`${(t-(this.options.columns-1)*this.options.gap)/this.options.columns}px`;this.distributeDesktopItems(n)}}distributeMobileItems(){this.items.forEach((e,t)=>{e.element.style.cssText=`
        position: relative;
        width: calc(100% - 2 * var(--space-sm));
        margin-left: var(--space-sm);
        margin-right: var(--space-sm);
        margin-bottom: var(--space-sm);
        left: 0;
        top: 0;
        box-sizing: border-box;
      `,this.options.enableMobileOptimization&&(e.element.style.animation=`slideInUp 0.3s ease-out ${t*.05}s both`)}),this.container.style.height="auto"}distributeDesktopItems(e){this.items.forEach(t=>{t.element.style.width=e}),this.items.forEach(e=>{e.height=e.element.offsetHeight}),this.items.forEach(t=>{const n=this.columns.reduce((e,t)=>t.height<e.height?t:e),s=n.index*(parseFloat(e)+this.options.gap),o=n.height;this.setItemPosition(t.element,s,o,e),n.height+=t.height+this.options.gap,n.items.push(t)});const t=Math.max(...this.columns.map(e=>e.height));this.container.style.height=`${t}px`}setItemPosition(e,t,n,s){e.style.position="absolute",e.style.left=`${t}px`,e.style.top=`${n}px`,e.style.width=typeof s=="string"?s:`${s}px`}setupResizeListener(){const e=()=>{this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{const e=this.isMobile,t=this.isTablet;this.updateDeviceType(),e!==this.isMobile||t!==this.isTablet?this.relayout():this.relayout()},this.options.debounceDelay)};window.addEventListener("resize",e,{passive:!0}),window.addEventListener("orientationchange",()=>{setTimeout(()=>this.relayout(),100)})}setupTouchSupport(){if(!this.isMobile)return;let e=0,t=0;this.container.addEventListener("touchstart",t=>{e=t.touches[0].clientY},{passive:!0}),this.container.addEventListener("touchend",n=>{t=n.changedTouches[0].clientY;const s=e-t;(s<0?-s:s)>50&&this.handleSwipe(s>0?"up":"down")},{passive:!0})}handleSwipe(e){e==="up"&&this.options.enableVirtualScroll&&this.loadMoreItems()}showContainer(){this.container.style.opacity="1",this.container.style.visibility="visible"}relayout(){if(!this.isInitialized)return;this.items.forEach(e=>{e.element.style.cssText=""}),this.container.style.height="auto",this.calculateColumns(),this.distributeItems()}setupVirtualScroll(){this.setupContainer(),this.calculateColumns(),this.items.forEach(e=>{e.element.style.display="none"}),this.observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&this.loadMoreItems()})},{root:null,rootMargin:`${this.options.threshold}px`,threshold:.1}),this.createTriggerElement()}batchRender(){const e=Math.min(this.renderedCount+this.options.batchSize,this.totalItems),t=this.items.slice(this.renderedCount,e);t.forEach(e=>{e.element.style.display=""}),this.distributeBatchItems(t),this.renderedCount=e,this.renderedCount<this.totalItems?this.observer.observe(this.triggerElement):this.observer.disconnect()}distributeBatchItems(e){const t=this.container.offsetWidth;if(this.isMobile&&this.options.enableMobileOptimization)this.distributeMobileBatchItems(e);else{const n=this.isTablet?t-2*16:t,s=this.options.columns===1?`${n}px`:`${(n-(this.options.columns-1)*this.options.gap)/this.options.columns}px`;this.distributeDesktopBatchItems(e,s)}}distributeMobileBatchItems(e){e.forEach((e,t)=>{e.element.style.cssText=`
        position: relative;
        width: calc(100% - 2 * var(--space-sm));
        margin-left: var(--space-sm);
        margin-right: var(--space-sm);
        margin-bottom: var(--space-sm);
        left: 0;
        top: 0;
        box-sizing: border-box;
      `,this.options.enableMobileOptimization&&(e.element.style.animation=`slideInUp 0.3s ease-out ${t*.05}s both`)})}distributeDesktopBatchItems(e,t){e.forEach(e=>{e.element.style.width=t}),e.forEach(e=>{e.height=e.element.offsetHeight}),e.forEach(e=>{const n=this.columns.reduce((e,t)=>t.height<e.height?t:e),s=n.index*(parseFloat(t)+this.options.gap),o=n.height;this.setItemPosition(e.element,s,o,t),n.height+=e.height+this.options.gap,n.items.push(e)});const n=Math.max(...this.columns.map(e=>e.height));this.container.style.height=`${n}px`}createTriggerElement(){this.triggerElement=document.createElement("div"),this.triggerElement.style.cssText=`
      position: absolute;
      bottom: -100px;
      left: 0;
      width: 100%;
      height: 1px;
      pointer-events: none;
    `,this.container.appendChild(this.triggerElement)}loadMoreItems(){this.renderedCount<this.totalItems&&requestAnimationFrame(()=>{this.batchRender()})}getPerformanceStats(){return{totalItems:this.totalItems,renderedItems:this.renderedCount,visibleItems:this.visibleItems.size,isVirtualScrollEnabled:this.options.enableVirtualScroll&&this.totalItems>this.options.batchSize,columns:this.options.columns,batchSize:this.options.batchSize,isMobile:this.isMobile,isTablet:this.isTablet}}destroy(){this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.observer&&this.observer.disconnect(),this.triggerElement&&this.triggerElement.parentNode&&this.triggerElement.parentNode.removeChild(this.triggerElement),this.items.forEach(e=>e.element.style.cssText=""),this.container.style.cssText="",this.container.classList.remove("mobile-waterfall"),this.visibleItems.clear()}}class WaterfallManager{constructor(){this.instances=new Map,this.isInitialized=!1}init(e=".article-list",t={}){const n=document.querySelector(e);if(!n)return null;const s=e;this.instances.has(s)&&this.destroy(s);const o=new WaterfallLayout(n,t);return this.instances.set(s,o),n.classList.add("waterfall-container"),document.body.classList.add("waterfall-page"),o}destroy(e){const t=this.instances.get(e);if(t){t.destroy(),this.instances.delete(e);const n=document.querySelector(e);n&&n.classList.remove("waterfall-container","mobile-waterfall"),this.instances.size===0&&document.body.classList.remove("waterfall-page")}}destroyAll(){this.instances.forEach((e,t)=>{this.destroy(t)})}relayout(e){const t=this.instances.get(e);t&&t.relayout()}relayoutAll(){this.instances.forEach(e=>{e.relayout()})}}window.waterfallManager=new WaterfallManager;function initWaterfallLayout(){const e=document.querySelector(".waterfall-layout");e?(window.waterfallManager.init(".article-list"),document.body.classList.add("waterfall-page")):document.body.classList.add("single-column")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",initWaterfallLayout):initWaterfallLayout(),window.WaterfallLayout=WaterfallLayout